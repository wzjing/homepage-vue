<blockquote>
<p>ç§»æ¤ffmpegåˆ°Androidç³»ç»Ÿï¼Œå¯¹ffmpegè¿›è¡Œè·¨å¹³å°ç¼–è¯‘å¹¶ä¿®æ”¹å…¶ä¸­çš„åŠŸèƒ½æ¨¡å—ç»„æˆï¼Œä»…ç¼–è¯‘éœ€è¦çš„åŠŸèƒ½
</p>
</blockquote>
<br/>
<h2>ç¼–è¯‘ç¯å¢ƒ</h2>
<p>Androidæ˜¯Linuxå†…æ ¸ï¼Œæœ€å¥½æ˜¯åœ¨Linuxä¸‹è¿›è¡Œç¼–è¯‘ã€‚æœ¬æ–‡é‡‡ç”¨Ubuntu 18.0.4 LTSç³»ç»Ÿè¿›è¡Œç¼–è¯‘ã€‚</p>
<br/>
<p>ç¼–è¯‘å·¥å…·ğŸ› </p>
<br/>
<ul>
<li>git â€” npm install git</li>
<li>make â€” npm install make</li>
<li>ndk R20 â€” <a href="https://dl.google.com/android/repository/android-ndk-r20-linux-x86_64.zip">ä¸‹è½½åœ°å€</a>
</li>
</ul>
<br/>
<h2>ç¼–è¯‘æºç </h2>
<ol style="counter-reset:ol 0">
<li>å…‹éš†æºç </li>
</ol>
<p>ä½¿ç”¨gitå·¥å…·ä»ä»“åº“å…‹éš†æœ€æ–°æºç ï¼š</p>
<pre><code class="shell">git clone https://git.ffmpeg.org/ffmpeg.git workspace/ffmpeg
</code></pre>
<br/>
<ol style="counter-reset:ol 1">
<li>ç¼–è¯‘ç¯å¢ƒ</li>
</ol>
<p> æˆ‘ä»¬éœ€è¦å°†NDKçš„å·¥å…·é“¾æš´éœ²åˆ°ç¯å¢ƒå˜é‡ä¸­ï¼Œå¹¶ä¸”ä¿®æ”¹é»˜è®¤çš„ç¼–è¯‘å˜é‡çš„å€¼ï¼Œå¦‚$cc </p/>
<pre><code class="language-shell">cd workspace

$MIN_API=21
export $ARCH=arm64
export $TOOLCHAIN=/path/to/ndk
export $INSTALL_DIR=`pwd`/build/$ARCH
export $CROSS_PREFIX=&quot;aarch64-linux-android&quot;
export CC=armv7a-linux-androideabi${MIN_API}-clang
export CXX=armv7a-linux-androideabi${MIN_API}-clang++
export AR=$CROSS_PREFIX-ar
export AS=$CC
export LD=$CROSS_PREFIX-ld
export STRIP=$CROSS_PREFIX-strip
export PATH=$PATH:$TOOLCHAIN/bin

EXTRA_CFLAGS=&quot;-fPIC -fPIE&quot;
EXTRA_LDFLAGS=&quot;-fpie&quot;
</code></pre>
<br/>
<ol style="counter-reset:ol 2">
<li>é…ç½®configure</li>
</ol>
<p>å¯¹ffmpegçš„è‡ªå¸¦æ¨¡å—å’Œç¼–è¯‘é€‰é¡¹åšä¸€äº›å¿…è¦çš„é…ç½®ï¼Œè¿™é‡Œåˆ—å‡ºä¸€ä¸ªå¸¸ç”¨çš„ç¼–è¯‘é…ç½®ï¼Œå…¶ä»–çš„ä¸€äº›ç¼–è¯‘é€‰é¡¹å¯è‡ªè¡Œä½¿ç”¨<code>./configure --help</code>è¿›è¡ŒæŸ¥çœ‹</p>
<pre><code class="language-shell">cd ffmpeg

./configure --enable-gpl \
    --enable-version3 \
    --enable-nonfree \
    --target-os=android \
    --disable-static \
    --enable-shared \
    --enable-pic \
    --arch=arm64 \
    --prefix=$INSTALL_DIR \
    --sysroot=$TOOLCHAIN/sysroot \
    --enable-small \
    --disable-programs \
    --disable-doc \
    --enable-debug \
    --enable-mediacodec \
    --enable-jni \
    --logfile=$CONFIGURE_LOG \
    --enable-cross-compile \
    --cross-prefix=$CROSS_PREFIX- \
    --cc=$CC \
    --cxx=$CXX \
    --objcc=$CC \
    --dep-cc=$CC \
    --pkg-config=pkg-config \
    --extra-cflags=&quot;$EXTRA_CFLAGS&quot; \
    --extra-ldflags=&quot;$EXTRA_LDFLAGS&quot;
</code></pre>
<ul>
<li>é€šè¿‡prefixé€‰é¡¹è®¾ç½®ç¼–è¯‘ç»“æœçš„ä¿å­˜ç›®å½•</li>
<li>å…³é—­docã€programsç”Ÿæˆã€é™æ€åº“ç”Ÿæˆç­‰ä¸€äº›ä¸å¿…è¦çš„åŠŸèƒ½</li>
<li>è®¾ç½®androidç¼–è¯‘å‚æ•°ï¼Œtarget-osè®¾ç½®ä¸ºandroidï¼Œcpuçš„archè®¾ç½®ä¸ºarm64ï¼Œsysrootè®¾ç½®ä¸ºndkçš„sysrootè·¯å¾„</li>
<li>ç¡¬ä»¶è§£ç çš„æ”¯æŒï¼Œffmpegå¯ä»¥å¼€å¯å¯¹androidç¡¬ä»¶è§£ç çš„æ”¯æŒï¼Œå¯ä»¥æå¤§çš„æå‡è§£ç æ•ˆç‡ï¼Œéœ€è¦å¯åŠ¨mediacodecå’Œjniï¼Œä½†æ˜¯å¹¶ä¸æ”¯æŒç¡¬ä»¶ç¼–ç ğŸ˜”</li>
<li>è®¾ç½®å…³äºç¼–è¯‘åŠä¼˜åŒ–ç›¸å…³çš„é€‰é¡¹ï¼Œæ¯”å¦‚picï¼Œpkg-configï¼Œccï¼Œç­‰ï¼Œè¿˜å¯ä»¥æ·»åŠ é¢å¤–çš„ç¼–è¯‘å‚æ•°å’Œè¿æ¥å‚æ•°</li>
</ul>
<br/>
<ol style="counter-reset:ol 3">
<li>å¼€å§‹ç¼–è¯‘</li>
</ol>
<p>æ ¹æ®è‡ªå·±çš„cpuæ ¸å¿ƒæ•°è®¾ç½®ç¼–è¯‘å¯ç”¨çš„æœ€å¤§çº¿ç¨‹ï¼Œä¸€èˆ¬æœ€å¥½ç­‰äºcpuçš„æ ¸å¿ƒæ•°</p>
<pre><code class="language-shell">make clean
make -j 4
make install
</code></pre>
<br/>
<h2>ä½¿ç”¨</h2>
<p>åœ¨Android Studioå·¥ç¨‹ä¸­åŠ å…¥C++æ”¯æŒï¼Œæˆ–æ–°å»ºæ”¯æŒC++çš„Androidå·¥ç¨‹ï¼Œç›¸å…³è®¾ç½®å¯è‡ªè¡ŒæŒ‰ç…§Android Studioå¼•å¯¼æ“ä½œï¼Œæˆ‘ä»¬ä¸»è¦å…³å¿ƒä¸€ä¸‹CMakeçš„ç›¸å…³è®¾ç½®
</p>
<br/>
<ol>
<li>é¦–å…ˆåœ¨Android Studioå·¥ç¨‹çš„jniLibsç›®å½•ä¸‹æ–°å»ºarm64ç›®å½•ï¼Œå°†ç”Ÿæˆçš„soåŠ¨æ€åº“æ–‡ä»¶å’Œincludeå¤´æ–‡ä»¶æ‹·è´åˆ°æ­¤æ–‡ä»¶å¤¹</li>
<li>åœ¨CMakeLists.txtä¸­æ·»åŠ ffmpegçš„åº“</li>
</ol>
<pre><code class="language-cmake">set(JNI_LIBS &quot;../src/main/jniLibs&quot;)
function(import_library name type filename)
    add_library(${name} ${type} IMPORTED)
    set_target_properties(${name} PROPERTIES IMPORTED_LOCATION ${JNI_LIBS}/${CMAKE_ANDROID_ARCH_ABI}/${filename})
endfunction()

import_library(avcodec SHARED libavcodec.so)
import_library(avformat SHARED libavformat.so)
import_library(avfilter SHARED libavfilter.so)
import_library(avutil SHARED libavutil.so)
import_library(swresample SHARED libswresample.so)
import_library(swscale SHARED libswscale.so)

include_directories(&quot;${JNI_LIBS}/include&quot;)
</code></pre>
<br/>
